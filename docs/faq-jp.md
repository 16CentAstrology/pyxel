# Pyxel よくある質問

## 新バージョンへの移行方法

<details>
<summary>バージョン2.4への移行方法</summary>

Pyxel 2.4 ではサウンドエンジンと MML 文法が刷新されています。<br>
コードをバージョン 2.4 に対応させるには、以下の変更を行ってください。

- Tone クラスの `waveform` フィールドを `wavetable` にリネームする
- `play` 関数、`playm` 関数の `tick` 引数を `sec`（小数形式の秒数）に変更する
- `play_pos` 関数の戻り値が `(sound_no, sec)` に変わったことに対応する
- Sound クラス、Music クラスの `save` 関数の `count` 引数を `sec` に変更する
- サウンドの再生秒数が必要な場合は、Sound クラスの `total_sec` 関数を利用する
- Sound クラスの `mml` 関数には新 MML 文法に沿ったコードを指定する
- 旧 MML 文法 を使用する場合は、Sound クラスの `old_mml` 関数を使用する
- `save`、`load` 関数の `exclude_xxx` オプションを `skip_xxx` に変更する
- `save`、`load` 関数の `include_xxx` オプションの指定を削除する

新しい MML 文法は後述の「Pyxel の MML の使い方」を参照してください。

</details>

<details>
<summary>バージョン1.5への移行方法</summary>

コードをバージョン 1.5 に対応させるには、以下の変更を行ってください。

- `init` の `caption` オプションを `title` にリネームする
- `init` の `scale` オプションを `display_scale` にリネームする
- `init` から `palette` オプションを削除する (初期化後に `colors` 配列でパレットカラーを変更できます)
- `init` から `fullscreen` オプションを削除する (初期化後に `fullscreen` 関数でフルスクリーンを切り替えることができます)
- キー名の未定義エラーが発生した場合、[キー定義](https://github.com/kitao/pyxel/blob/main/python/pyxel/__init__.pyi) に従ってキー名をリネームする
- `Image` クラスおよび `Tilemap` クラスの `get` と `set` をそれぞれ `pget` と `pset` に変更する
- `bltm` の `u`, `v`, `w`, `h` パラメータを 8 倍に変更する (`bltm` はピクセル単位で動作するようになりました)
- `Sound` および `Music` クラスのメンバーとメソッドを新しい名前に更新する

</details>

<details>
<summary>バージョン1.5以降で<code>pyxeleditor</code>コマンドが使えません</summary>

バージョン 1.5 以降、Pyxel のツールは`pyxel`コマンドに統合されました。リソースエディタにアクセスするには、次のコマンドを使用してください： `pyxel edit [PYXEL_RESOURCE_FILE]`

</details>

## Pyxel の学び方

<details>
<summary>Pyxelを学習するにはどこから始めればいいですか？</summary>

Pyxel のサンプルコードを 01、05、03、04、02 の順に試すのがおすすめです。

</details>

<details>
<summary>Pyxelに関する書籍はありますか？</summary>

日本語版のみですが、[公式の書籍](https://gihyo.jp/book/2025/978-4-297-14657-3)が発売されています。

</details>

## API 仕様と使い方

<details>
<summary><code>update</code>関数と<code>draw</code>関数の違いは何ですか？</summary>

`update`関数は毎フレーム呼び出されますが、`draw`関数は処理時間が許容限界を超えた場合にスキップされることがあります。Pyxel はこの設計により、レンダリング負荷や OS の割り込み処理の影響を軽減して、滑らかなアニメーションを実現しています。

</details>

<details>
<summary>PyxelのMMLの使い方を教えてください</summary>

Sound クラスの`mml`関数に MML (Music Macro Language) 文字列を渡すと、MML モードに移行し、その内容に沿ってサウンドが再生されるようになります。

MML モードでは、`notes`や`speed`などの通常のパラメータは無視され、指定した文字列の内容に沿ってサウンドが再生されます。`mml()`を呼ぶと MML モードをリセットできます。

`play`関数にサウンド番号の代わりに直接 MML 文字列を渡して再生することもできます。<br>
例：`pyxel.play(0, "CDEFG")`

Pyxel の MML で利用できるコマンドは以下のとおりです。

- `T <bpm>`(1-)<br>
  テンポ (BPM) を指定する。デフォルトは 120。<br>

- `Q <gate_percent>`(0-100)<br>
  発音する長さをパーセントで指定する。100 で音の切れ目がなくなり、0 だと発音されない。デフォルトは 80。

- `@ <tone_index>`(0-)<br>
  音色番号（初期状態では 0:Triangle / 1:Square / 2:Pulse / 3:Noise）を指定する。デフォルトは 0。

- `V <vol>`(0-127)<br>
  音量を指定する。デフォルトは 100。

- `K <key_offset>`(整数)<br>
  トランスポーズ量（音程オフセット）を半音単位で指定する。12 で音程が 1 オクターブ上がる。デフォルトは 0。

- `Y <offset_cents>`(整数)<br>
  デチューン（音程ずれ）を cent 単位で指定する。100 で半音上がり、-100 で半音下がる。デフォルトは 0。

- `@ENV <slot>`(0-)<br>
  エンベロープ（音量変化のカーブ）のスロットを切り替える。0 を指定するとオフになる。

- `@ENV <slot> { init_vol, dur_ticks1, vol1, dur_ticks2, vol2, ... }`<br>
  指定したスロットのエンベロープを設定して切り替える。スロット 0 は指定できない。<br>
  { }内は、「初期音量 (最初の 1 回のみ)」の後、「区間の長さ (tick)、音量 (vol)」を繰り返し指定する。1 tick は 4 分音符を 48 等分した長さ。<br>
  例：`@ENV 1 { 30, 20, 100, 50, 0 }`（音量を 30 から 20 tick かけて 100 にした後, 50 tick かけて 0 に変化させる）

- `@VIB <slot>`(0-)<br>
  ビブラート（音程を揺らすエフェクト）のスロットを切り替える。0 を指定するとオフになる。

- `@VIB <slot> { delay_ticks, period_ticks, depth_cents }` <br>
  指定したスロットのビブラートを設定して切り替える。スロット 0 は指定できない。<br>
  { }内は「ディレイ時間 (tick)、周期 (tick)、深さ (cent)」をこの順で指定する。1 tick は 4 分音符を 48 等分した長さ。<br>
  例：`@VIB 1 {24, 12, 100}`（24 tick 経過後、12 tick 周期でプラス半音からマイナス半音の範囲で音程を揺らす）

- `@GLI <slot>`(0-)<br>
  グライド（音程変化のエフェクト）のスロットを切り替える。0 を指定するとオフになる。

- `@GLI <slot> { offset_cents, dur_ticks }` <br>
  { }内は「最初の音程変化量 (cent)、0 に戻るまでの時間 (tick)」を指定する。1 tick は 4 分音符を 48 等分した長さ。<br>
  例：`@GLI 1 { -100, 24 }`（半音下から始まり、24 tick かけて本来の音程に戻る）

- `O <oct>`(-1 - 9)<br>
  オクターブを指定する。`O4`の A の音が 440 Hz になる。デフォルトは 4。

- `>`<br>
  オクターブを 1 上げる。最大 9。

- `<`<br>
  オクターブを 1 下げる。最小 -1。

- `L <len>`(1-192)<br>
  音符と休符のデフォルトの長さを指定する。L4 が 4 分音符。デフォルトは 4。

- `C/D/E/F/G/A/B`<br>
  指定した音階の音を再生する。`F16`のように後ろに長さを指定すると、その音だけ長さを変更する。

- `R`<br>
  休符を再生する。`R8`のように後ろに長さを指定すると、その休符だけ長さを変更する。

- `#/+`<br>
  音の後ろに記述すると、その音を半音上げる。

- `-`<br>
  音の後ろに記述すると、その音を半音下げる。

- `.`<br>
  付点。音や休符の後ろに記述すると、長さを 1/2 延ばす。複数指定することも可能。
  。
- `&`<br>
  タイ。同じ音程の次の音を一つの音として繋げる。異なる高さの音に指定するとエラーになる。

- `[`<br>
  繰り返し開始位置。

- `] <count>`<br>(1-)
  繰り返し終了位置。繰り返し開始位置との間のフレーズを指定した回数だけ再生する。回数を省略した場合は無限に繰り返す。入れ子にすることも可能。

</details>

## ファイル操作とデータ管理

<details>
<summary>ファイルが読み込めません。環境が変わると失敗する時があります。</summary>

ファイルを読み込む際に、カレントディレクトリが意図したものになっているかを確認してください。<br>
Pyxel の`init`関数が呼ばれると、カレントディレクトリはそのスクリプトファイルと同じ場所に変更され、それ以降は相対パスでファイルを指定できます。しかし、`init`を呼ぶ前にファイルを開こうとした場合や`init`の後にカレントディレクトリを変更した場合には読み込みに失敗する可能性があります。

</details>

<details>
<summary>ハイスコアやゲームの進行状況など、アプリケーション固有のデータを保存する方法はありますか？</summary>

`user_data_dir(vendor_name, app_name)`関数に開発者名とアプリ名を渡すと、プラットフォームに適したデータ保存用のディレクトリを作成し、そのパスを返します。このディレクトリの下でアプリケーション用のファイルの保存や読み込みを行ってください。

</details>

## Pyxel ツールの使い方

<details>
<summary>Pyxel Editorでパレットの色を変更できますか？</summary>

Pyxel リソースファイル（.pyxres）と同じディレクトリに、Pyxel パレットファイル（.pyxpal）を配置することで、Pyxel Editor で使用するパレットの色をリソースファイルに合わせることができます。Pyxel パレットファイルの作成方法については、README をご参照ください。

</details>

## 今後の開発計画

<details>
<summary>今後のリリースで予定している機能は？</summary>

以下の機能追加や改善を予定しています。

- Pyxel アプリランチャーの追加
- Pyxel Editor の操作性向上
- 子供向け Pyxel チュートリアルの追加

</details>

## ライセンスとスポンサーシップ

<details>
<summary>Pyxelを作者の許可なく商業目的で使用することはできますか？</summary>

MIT ライセンスに従い、ソースコードやライセンス表示用のファイルに著作権およびライセンスの全文を明示すれば、作者の許可を得ることなく自由に販売や配布が可能です。ただし、もし可能であれば、作者にご連絡いただいたり、スポンサーとしてご支援いただけるとありがたいです。

</details>
