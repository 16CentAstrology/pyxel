<!DOCTYPE html>
<html>
  <head>
    <title>Pyxel Web Launcher</title>
    <script src="https://cdn.jsdelivr.net/gh/kitao/pyxel@v1.8.12/wasm/pyxel.js"></script>
  </head>
  <body>
    <script>
      function printUsage() {
        document.oncontextmenu = null;
        document.body.style.overflow = "";
        document.body.style.touchAction = "";
        document.body.innerHTML = `
          <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
          />
          <h1>Pyxel Web Launcher</h1>
          <p>
            Launcher tool for the WebAssembly version of
            <a href="https://github.com/kitao/pyxel" target="_blank">Pyxel</a>,
            a retro game engine for Python.
          </p>
          <p>
            If your Pyxel program is on GitHub, you can use this tool to run it
            in a web browser.
          </p>
          <p>
            If you want to run a Pyxel program that is not on GitHub, please
            refer to <a href="wasm/examples.html" target="_blank">this page</a>.
          </p>

          <h2>Usage</h2>
          <h3>Run a Python Script using Pyxel</h3>
          <p class="code">
            https://kitao.github.io/pyxel/?run=user_name.repo_name.dir_name.script_without_extension
          </p>
          <p>
            Add <span class="code">&gamepad=enabled</span> to the end of the URL
            to enable the virtual gamepad
          </p>
          <h3>Play a Pyxel Application (.pyxapp)</h3>
          <p class="code">
            https://kitao.github.io/pyxel/?play=user_name.repo_name.dir_name.pyxapp_without_extension
          </p>
          <p>
            Add <span class="code">&gamepad=enabled</span> to the end of the URL
            to enable the virtual gamepad
          </p>
          <h3>Edit a Pyxel Resource File (.pyxres)</h3>
          <p class="code">
            https://kitao.github.io/pyxel/?edit=user_name.repo_name.dir_name.pyxres_without_extension
          </p>
          <p>
            Add <span class="code">&editor="image/tilemap/sound/music"</span> to
            the end of the URL to change the starting editor
          </p>
        `;
      }

      const params = new URL(document.location).searchParams;
      let tag, ext, param;
      if (params.get("run")) {
        tag = "pyxel-run";
        ext = ".py";
        param = params.get("run");
      } else if (params.get("play")) {
        tag = "pyxel-play";
        ext = ".pyxapp";
        param = params.get("play");
      } else if (params.get("edit")) {
        tag = "pyxel-edit";
        ext = ".pyxres";
        param = params.get("edit");
      } else {
        printUsage();
      }
      if (tag) {
        let elem = document.createElement(tag);
        let paths = param.split(".");
        elem.root =
          "https://cdn.jsdelivr.net/gh/" + paths.slice(0, -1).join("/");
        elem.name = paths[paths.length - 1] + ext;
        elem.gamepad = params.get("gamepad");
        elem.editor = params.get("editor");
        document.body.appendChild(elem);
        console.log(`${tag}: ${elem.root + "/" + elem.name}`);
      }
    </script>
  </body>
</html>
